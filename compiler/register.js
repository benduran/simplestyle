import path from 'node:path';
import { createJiti } from 'jiti';
import { COLLECTOR } from './collector.js';

const j = createJiti(import.meta.url, {
  alias: {
    'simplestyle-js/ssr': path.join(import.meta.dirname, 'mock.js'),
  },
  interopDefault: true,
  // Disable runtime module cache so watch recompiles re-run user modules.
  moduleCache: false,
  jsx: true,
});

/**
 * extracts styles generated by a call to createStyles
 *
 * @param {string} userFilePath
 */
export async function extract(userFilePath) {
  await j.import(userFilePath);

  return COLLECTOR;
}
